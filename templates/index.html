<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disk Extractor - Movie Metadata Manager</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/encoding.css') }}">
</head>
<body>
    <div class="header">
        <h1>Disk Extractor - Movie Metadata Manager</h1>
        <div class="header-actions">
            <a href="{{ url_for('settings') }}" class="settings-link">‚öôÔ∏è Settings</a>
        </div>
    </div>
    
    <!-- Disconnection Overlay -->
    <div id="disconnectionOverlay" class="disconnection-overlay hidden">
        <div class="disconnection-message">
            <div class="disconnection-icon">‚ö†Ô∏è</div>
            <h2>Connection Lost</h2>
            <p>Lost connection to server. Attempting to reconnect...</p>
            <div class="reconnection-spinner"></div>
        </div>
    </div>
    
    <div class="container">
        <div class="sidebar">
            <!-- Pinned Encoding Section -->
            <div id="encodingSection" class="encoding-section" style="display: none;">
                <div class="encoding-section-header">
                    <h4>üé¨ Currently Encoding</h4>
                </div>
            </div>
            
            <div class="sidebar-content">
                <ul class="file-list" id="fileList">
                    {% for movie in movies %}
                    <li class="file-item" data-filename="{{ movie.file_name }}" data-movie-index="{{ loop.index0 }}">
                    </li>
                    {% endfor %}
                </ul>
            </div>
            
            <!-- Stats for Nerds section - Fixed at bottom -->
            <div id="statsForNerds" class="stats-for-nerds hidden">
                <div class="stats-header">
                    <h4>üìä Stats for Nerds</h4>
                    <button class="stats-close-btn" onclick="toggleStatsForNerds(false)" title="Close Stats">√ó</button>
                </div>
                <div id="statsContent" class="stats-content">
                    <div class="stats-loading">Loading...</div>
                </div>
            </div>
        </div>
        
        <div class="resizer" id="resizer"></div>
        
        <div class="main-content">
            <div id="emptyState" class="empty-state">
                <h2>Select a movie file to begin</h2>
                <p>Choose a file from the list on the left to view and edit its metadata.</p>
            </div>
            
            <div id="metadataForm" style="display: none;">
                <div class="file-info-section">
                    <h2 id="currentFileName">No file selected</h2>
                    <div class="file-actions-row">
                        <div class="file-size">
                            <span id="currentFileSize"></span>
                        </div>
                        <div class="action-buttons">
                            <button type="button" id="scanButton" onclick="scanFile()" class="action-button scan-button">üîç Scan Media</button>
                            <button type="button" id="rawOutputButton" onclick="showRawOutput()" class="action-button raw-output-button" style="display: none;">üìÑ Raw Output</button>
                        </div>
                    </div>
                </div>
                
                <div id="enhancedMetadata" class="enhanced-metadata">
                    <div id="scanError" class="scan-error" style="display: none;">
                        <h3>‚ö†Ô∏è HandBrake Scan Error</h3>
                        <button type="button" onclick="scanFile()" class="action-button scan-button">üîÑ Retry Scan</button>
                        <p id="scanErrorMessage"></p>
                    </div>
                    
                    <div class="titles-container" id="titlesContainer">
                        <!-- Titles will be populated by JavaScript -->
                    </div>
                </div>
                
                <!-- Encoding History Section -->
                <div class="encoding-history" id="encodingHistory" style="display: none;">
                    <h4>Encoding History</h4>
                    <div id="historyContainer">
                        <!-- History items will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Raw Output Modal -->
    <div id="rawOutputModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>HandBrake Raw Output</h2>
                <span class="close" onclick="closeRawOutputModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="rawOutputContent">
                </div>
            </div>
        </div>
    </div>
    
    <!-- Minimal addition: notification area -->
    <div id="notifications" class="notifications"></div>
    
    <!-- JavaScript Files -->
    <script src="{{ url_for('static', filename='js/vendor/socket.io.js') }}"></script>
    <script src="{{ url_for('static', filename='js/file-list.js') }}"></script>
    <script src="{{ url_for('static', filename='js/websocket.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/encoding.js') }}"></script>
    <script src="{{ url_for('static', filename='js/init.js') }}"></script>
    
    <!-- Initialize with server data -->
    <script>
        // Initialize the application with movie data from server
        document.addEventListener('DOMContentLoaded', function() {
            const movies = {{ movies | tojson }};
            initializeApplication(movies);
        });
    </script>
</body>
</html>
